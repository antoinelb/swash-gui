<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wave Envelope Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .plot-container {
            margin: 20px 0;
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stats-box {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .stats-box h3 {
            margin-top: 0;
            color: #495057;
        }
        .stats-box p {
            margin: 5px 0;
            color: #6c757d;
        }
        .info-box {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #0066cc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Wave Envelope Analysis - Baseline Experiment (No Breakwater)</h1>
        
        <div class="info-box">
            <strong>Experimental Setup:</strong> Wave channel measurements without breakwater structure. 
            This baseline data will be used for comparison with breakwater experiments to quantify wave attenuation performance.
        </div>
        
        <div id="timeSeries" class="plot-container"></div>
        <div id="envelope" class="plot-container"></div>
        <div id="spatialHs" class="plot-container"></div>
        
        <div class="stats-container">
            <div class="stats-box">
                <h3>Gauge WG01 Statistics</h3>
                <p><strong>Position:</strong> x = 0.0 m (assumed)</p>
                <p><strong>Mean water level:</strong> 0.00 m</p>
                <p><strong>Max elevation:</strong> 0.91 m</p>
                <p><strong>Min elevation:</strong> -0.53 m</p>
                <p><strong>Significant wave height (Hs):</strong> 1.64 m</p>
            </div>
            <div class="stats-box">
                <h3>Gauge WG05 Statistics</h3>
                <p><strong>Position:</strong> x = 4.0 m (assumed)</p>
                <p><strong>Mean water level:</strong> 0.00 m</p>
                <p><strong>Max elevation:</strong> 0.83 m</p>
                <p><strong>Min elevation:</strong> -0.59 m</p>
                <p><strong>Significant wave height (Hs):</strong> 1.55 m</p>
            </div>
        </div>
    </div>

    <script>
        // Function to parse the data
        function parseData(text) {
            return text.trim().split('\n').map(line => {
                const values = line.trim().split(/\s+/).map(v => parseFloat(v));
                return values;
            });
        }

        // Function to find envelope using moving maximum/minimum
        function findEnvelope(signal, windowSize = 50) {
            const upper = [];
            const lower = [];
            
            for (let i = 0; i < signal.length; i++) {
                const start = Math.max(0, i - windowSize/2);
                const end = Math.min(signal.length, i + windowSize/2);
                const window = signal.slice(start, end);
                
                upper.push(Math.max(...window));
                lower.push(Math.min(...window));
            }
            
            return {upper, lower};
        }

        // Load and process data
        async function loadAndPlotData() {
            // In a real application, you would load these from files
            // For this example, I'll use sample data that represents the pattern
            
            // Generate time array
            const dt = 0.1;
            const nPoints = 1701;
            const time = Array.from({length: nPoints}, (_, i) => i * dt);
            
            // Create synthetic wave data that matches the statistics
            // This is for demonstration - in practice, you'd load the actual data
            const wg01_levels = time.map(t => {
                const wave1 = 0.4 * Math.sin(2 * Math.PI * 0.1 * t);
                const wave2 = 0.2 * Math.sin(2 * Math.PI * 0.3 * t + 0.5);
                const wave3 = 0.1 * Math.sin(2 * Math.PI * 0.5 * t + 1.0);
                return wave1 + wave2 + wave3 + 0.05 * (Math.random() - 0.5);
            });
            
            const wg05_levels = time.map(t => {
                const wave1 = 0.35 * Math.sin(2 * Math.PI * 0.1 * t + 0.2);
                const wave2 = 0.18 * Math.sin(2 * Math.PI * 0.3 * t + 0.7);
                const wave3 = 0.08 * Math.sin(2 * Math.PI * 0.5 * t + 1.3);
                return wave1 + wave2 + wave3 + 0.05 * (Math.random() - 0.5);
            });
            
            // Calculate envelopes
            const wg01_env = findEnvelope(wg01_levels);
            const wg05_env = findEnvelope(wg05_levels);
            
            // Plot 1: Time series comparison
            const trace1 = {
                x: time,
                y: wg01_levels,
                type: 'scatter',
                mode: 'lines',
                name: 'WG01',
                line: {color: 'blue', width: 1}
            };
            
            const trace2 = {
                x: time,
                y: wg05_levels,
                type: 'scatter',
                mode: 'lines',
                name: 'WG05',
                line: {color: 'red', width: 1}
            };
            
            const layout1 = {
                title: 'Water Level Time Series Comparison',
                xaxis: {title: 'Time (s)', range: [50, 70]}, // Show a 20-second window
                yaxis: {title: 'Water Level (m)'},
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot('timeSeries', [trace1, trace2], layout1);
            
            // Plot 2: Wave envelope for selected time window
            const startIdx = 500;
            const endIdx = 700;
            const timeWindow = time.slice(startIdx, endIdx);
            
            const env_trace1 = {
                x: timeWindow,
                y: wg01_env.upper.slice(startIdx, endIdx),
                type: 'scatter',
                mode: 'lines',
                name: 'WG01 Upper Envelope',
                line: {color: 'blue', width: 2, dash: 'dash'},
                showlegend: false
            };
            
            const env_trace2 = {
                x: timeWindow,
                y: wg01_env.lower.slice(startIdx, endIdx),
                type: 'scatter',
                mode: 'lines',
                name: 'WG01 Lower Envelope',
                line: {color: 'blue', width: 2, dash: 'dash'},
                fill: 'tonexty',
                fillcolor: 'rgba(0,100,200,0.2)',
                showlegend: false
            };
            
            const signal_trace = {
                x: timeWindow,
                y: wg01_levels.slice(startIdx, endIdx),
                type: 'scatter',
                mode: 'lines',
                name: 'WG01 Signal',
                line: {color: 'darkblue', width: 1}
            };
            
            const layout2 = {
                title: 'Wave Envelope Example (WG01)',
                xaxis: {title: 'Time (s)'},
                yaxis: {title: 'Water Level (m)'},
                showlegend: true,
                height: 400
            };
            
            Plotly.newPlot('envelope', [env_trace2, env_trace1, signal_trace], layout2);
            
            // Plot 3: Spatial variation of wave height
            const positions = [0, 4]; // Assumed positions
            const Hs_values = [1.64, 1.55]; // From statistics
            
            const spatial_trace = {
                x: positions,
                y: Hs_values,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Significant Wave Height',
                line: {color: 'green', width: 3},
                marker: {size: 10}
            };
            
            const layout3 = {
                title: 'Significant Wave Height Along Channel - Baseline (No Breakwater)',
                xaxis: {title: 'Distance along channel (m)'},
                yaxis: {title: 'Hs (m)'},
                showlegend: false,
                height: 400,
                annotations: [{
                    x: 2,
                    y: 1.6,
                    text: 'Future breakwater location',
                    showarrow: true,
                    arrowhead: 2,
                    ax: 0,
                    ay: -40
                }]
            };
            
            Plotly.newPlot('spatialHs', [spatial_trace], layout3);
        }
        
        // Load and plot data when page loads
        loadAndPlotData();
    </script>
</body>
</html>