# SWASH INPUT File Reference

## Overview

This document provides a detailed explanation of the SWASH INPUT file generated by the framework. The INPUT file is created from a **Jinja2 template** that substitutes configuration parameters into the SWASH command structure.

## File Structure and Sections

The INPUT file is organized into logical sections that define the complete wave modeling setup:

```
1. MODEL SETUP           - Basic simulation parameters
2. COMPUTATIONAL GRID    - Domain discretization  
3. BATHYMETRY           - Bottom topography
4. BREAKWATER POROSITY  - Porous structure definition
5. VEGETATION           - Vegetation drag modeling (optional)
6. WAVE GENERATION      - Incident wave conditions
7. PHYSICS              - Physical modeling options
8. NUMERICS             - Numerical solution methods
9. OUTPUT               - Data collection setup
10. RUN                 - Execution control
```

## Detailed Section Analysis

### 1. Model Setup
```swash
$ SWASH Input File - 1D Wave Channel Experiment
$ {{ name }}

PROJECT 'WaveChannel' '{{ name }}'

$=============================================================================
$ MODEL SETUP
$=============================================================================
$ Freshwater properties, standard gravity
SET level={{ water.water_level }} grav=9.81 rhowat={{ water.water_density }}

$ 1D nonstationary simulation
MODE NONSTATIONARY ONEDIMENSIONAL
```

**Purpose**: Establishes fundamental simulation parameters
**Key commands**:
- `PROJECT`: Names the simulation for SWASH output identification
- `SET level`: Defines still water level and reference densities
- `MODE`: Specifies 1D nonstationary (time-dependent) simulation

**Configuration mapping**:
- `{{ name }}` → Configuration filename (e.g., "dev")
- `{{ water.water_level }}` → Still water level from config
- `{{ water.water_density }}` → Water density (typically 1000 kg/m³)

### 2. Computational Grid
```swash
$=============================================================================
$ COMPUTATIONAL GRID
$=============================================================================
$ 1D grid: length={{ grid.length }}m, cells={{ grid.nx_cells }}
CGRID REGULAR 0.0 0.0 0.0 {{ grid.length }} 0.0 {{ grid.nx_cells }} 0

$ Vertical layers={{ grid.n_layers }} (equidistant)
VERTICAL {{ grid.n_layers }}
```

**Purpose**: Defines the computational domain discretization
**Key commands**:
- `CGRID REGULAR`: Creates regular rectangular grid
- `VERTICAL`: Sets number of vertical layers for 3D velocity structure

**Grid parameters**:
- Origin: (0, 0, 0) - bottom-left corner
- Extent: `grid.length` × 0 (1D domain)
- Resolution: `grid.nx_cells` cells in x-direction
- Cell size: `dx = grid.length / grid.nx_cells` (automatically calculated)

**Configuration mapping**:
- `{{ grid.length }}` → Domain length (default: 112.0 m)
- `{{ grid.nx_cells }}` → Number of grid cells (default: 500)
- `{{ grid.n_layers }}` → Vertical layers (default: 2)

### 3. Bathymetry
```swash
$=============================================================================
$ BATHYMETRY
$=============================================================================
INPGRID BOTTOM REGULAR 0.0 0.0 0.0 {{ grid.nx_cells }} 0 {{ "%.3f"|format(grid.length/grid.nx_cells) }} 1.0
READINP BOTTOM 1.0 'bathymetry.dat' IDLA=3 FREE
```

**Purpose**: Defines bottom topography
**Key commands**:
- `INPGRID BOTTOM`: Specifies grid for bottom elevation data
- `READINP BOTTOM`: Reads bottom elevations from file

**File generation**: The framework creates `bathymetry.dat` with:
- **Flat bottom** at elevation z = 0.0
- **Regular spacing** matching computational grid
- **Simple ASCII format** for easy verification

**Grid specification**:
- `{{ grid.nx_cells }}`: Number of data points
- `{{ "%.3f"|format(grid.length/grid.nx_cells) }}`: Grid spacing (dx)
- `IDLA=3 FREE`: Data layout and format specification

### 4. Breakwater Porosity
```swash
$=============================================================================
$ BREAKWATER POROSITY
$=============================================================================
{%- set breakwater_end = numeric.breakwater_start_position + breakwater.crest_width + 2 * (breakwater.crest_height * breakwater.slope) %}
$ Breakwater: {{ numeric.breakwater_start_position }}m to {{ "%.1f"|format(breakwater_end) }}m, slope={{ breakwater.slope }}:1

INPGRID POROSITY REGULAR 0.0 0.0 0.0 {{ grid.nx_cells }} 0 {{ "%.3f"|format(grid.length/grid.nx_cells) }} 1.0
READINP POROSITY 1.0 'porosity.dat' IDLA=3 FREE

INPGRID HSTRUCTURE REGULAR 0.0 0.0 0.0 {{ grid.nx_cells }} 0 {{ "%.3f"|format(grid.length/grid.nx_cells) }} 1.0
READINP HSTRUCTURE 1.0 'structure_height.dat' IDLA=3 FREE

$ Porosity parameters for rock: Dn50={{ breakwater.armour_dn50 }}m, height={{ breakwater.crest_height }}m
POROSITY {{ breakwater.armour_dn50 }} {{ breakwater.crest_height }} 200.0 1.1 {{ water.wave_period }}
```

**Purpose**: Defines porous breakwater structure
**Key components**:

#### Jinja2 Calculation
- `breakwater_end`: Automatically calculates structure extent based on geometry
- Formula: `start + crest_width + 2 × (crest_height × slope)`

#### Porosity Field (`porosity.dat`)
- **Values**: 0.0 (water), `breakwater.porosity` (structure)
- **Purpose**: Defines where porous media equations apply

#### Structure Height (`structure_height.dat`)
- **Values**: 0.0 (water), `breakwater.crest_height` (structure)
- **Purpose**: Defines top boundary of porous structure

#### POROSITY Command Parameters
1. `{{ breakwater.armour_dn50 }}`: Characteristic stone diameter
2. `{{ breakwater.crest_height }}`: Representative structure height
3. `200.0`: **Hard-coded** Forchheimer coefficient
4. `1.1`: **Hard-coded** shape factor
5. `{{ water.wave_period }}`: Representative wave period for resistance calculation

### 5. Vegetation (Conditional)
```swash
{%- if vegetation.enable %}
$=============================================================================
$ VEGETATION
$=============================================================================
$ Spatially varying vegetation density on breakwater crest only
$ Plant characteristics: height={{ vegetation.plant_height }}m, diameter={{ vegetation.plant_diameter }}m, drag={{ vegetation.drag_coefficient }}
$ Base density: 1 (multiplied by spatial density from vegetation_density.dat)

INPGRID NPLANTS REGULAR 0.0 0.0 0.0 {{ grid.nx_cells }} 0 {{ "%.3f"|format(grid.length/grid.nx_cells) }} 1.0
READINP NPLANTS 1.0 'vegetation_density.dat' IDLA=3 FREE

VEGETATION {{ vegetation.plant_height }} {{ vegetation.plant_diameter }} 1.0 {{ vegetation.drag_coefficient }}
{%- endif %}
```

**Purpose**: Adds vegetation drag forces on breakwater crest (when enabled)
**Conditional rendering**: Only included if `vegetation.enable: true`

**Key commands**:
- `INPGRID NPLANTS`: Defines grid for spatial vegetation density
- `READINP NPLANTS`: Reads vegetation density from file
- `VEGETATION`: Sets vegetation characteristics

**VEGETATION Command Parameters**:
1. `{{ vegetation.plant_height }}`: Plant height above bottom (m)
2. `{{ vegetation.plant_diameter }}`: Effective stem diameter (m)
3. `1.0`: Base density multiplier (actual density from file)
4. `{{ vegetation.drag_coefficient }}`: Drag coefficient (dimensionless)

**Implementation notes**:
- **Spatial variation**: Vegetation density varies according to `vegetation_density.dat`
- **Crest-only placement**: Non-zero density only on breakwater crest
- **Multiplication**: Final density = base (1.0) × spatial density from file
- **Physical basis**: Parameters based on coastal vegetation species

### 6. Wave Generation
```swash
$=============================================================================
$ WAVE GENERATION
$=============================================================================
$ Regular waves: H={{ water.wave_height }}m, T={{ water.wave_period }}s
BOUNDCOND SIDE WEST BTYPE WEAKREFL &
          CON REGULAR {{ water.wave_height }} {{ water.wave_period }} 0.0

$ Sponge layer at downstream end
SPONGE EAST 10.0
```

**Purpose**: Generates incident waves and manages boundaries
**Key commands**:

#### Wave Generation
- `BOUNDCOND SIDE WEST`: West boundary (x=0) wave generation
- `BTYPE WEAKREFL`: Weakly reflective boundary (absorbs some reflection)
- `CON REGULAR`: Regular wave with constant amplitude
- Parameters: height, period, phase (0.0)

#### Wave Absorption
- `SPONGE EAST 10.0`: **Hard-coded** 10m sponge layer at east boundary
- **Purpose**: Absorbs transmitted waves to prevent reflection

**Configuration mapping**:
- `{{ water.wave_height }}` → Regular wave height
- `{{ water.wave_period }}` → Wave period

### 7. Physics
```swash
$=============================================================================
$ PHYSICS
$=============================================================================
$ Manning friction n=0.019
FRICTION MANNING 0.019

{%- if grid.n_layers <= 3 %}
$ Wave breaking for coarse vertical resolution
BREAKING 0.6 0.3
{%- endif %}
```

**Purpose**: Defines physical modeling options
**Components**:

#### Bottom Friction
- `FRICTION MANNING 0.019`: **Hard-coded** Manning's roughness coefficient
- **Value**: n = 0.019 (typical for concrete/rock surfaces)

#### Wave Breaking (Conditional)
- **Condition**: Only applied if ≤ 3 vertical layers
- `BREAKING 0.6 0.3`: Breaking index and maximum gamma
- **Purpose**: Enhanced energy dissipation for coarse vertical resolution

### 8. Numerics
```swash
$=============================================================================
$ NUMERICS  
$=============================================================================
$ Non-hydrostatic with Box scheme (optimal for 2-3 layers)
NONHYDROSTATIC BOX 1.0

$ Adaptive time stepping: CFL 0.4-0.8
TIMEINT METH EXPLICIT 0.4 0.8
```

**Purpose**: Configures numerical solution methods
**Key commands**:

#### Non-hydrostatic Modeling
- `NONHYDROSTATIC BOX 1.0`: **Hard-coded** Box scheme with θ = 1.0
- **Purpose**: Accurate short wave modeling with vertical acceleration

#### Time Integration
- `TIMEINT METH EXPLICIT`: Explicit time stepping
- `0.4 0.8`: **Hard-coded** CFL range for adaptive time stepping
- **Adaptive**: SWASH adjusts time step between these limits

### 9. Output
```swash
$=============================================================================
$ OUTPUT
$=============================================================================
$ Wave gauges
{%- for i, pos in enumerate(numeric.wave_gauge_positions) %}
POINTS 'WG{{ "%02d"|format(i+1) }}' {{ pos }} 0.0
{%- endfor %}

$ Time series output
{%- for i, pos in enumerate(numeric.wave_gauge_positions) %}
TABLE 'WG{{ "%02d"|format(i+1) }}' NOHEADER 'wg{{ "%02d"|format(i+1) }}.dat' &
      WATLEV VEL OUTPUT 000000.000 {{ numeric.output_interval }} SEC
{%- endfor %}

$ Wave statistics (last 30 minutes by default)
QUANTITY HSIG dur=1800 sec
QUANTITY SETUP dur=1800 sec

$ Spatial output at end
FRAME 'channel' 0.0 0.0 0.0 {{ grid.length }} 1.0 {{ grid.nx_cells//4 }} 1
BLOCK 'channel' NOHEADER 'final_state.mat' LAY-OUT 3 &
      WATLEV VEL HSIG SETUP OUTPUT 000000.000 {{ numeric.output_interval }} SEC
```

**Purpose**: Configures data collection and output
**Components**:

#### Wave Gauges (Dynamic)
- **Jinja2 loop**: Creates gauges for each position in `numeric.wave_gauge_positions`
- **Naming**: WG01, WG02, ... WG05 (formatted with leading zeros)
- **Location**: At specified x-coordinates, y=0.0

#### Time Series Output (Dynamic)
- **Variables**: WATLEV (water level), VEL (velocity)
- **Frequency**: `{{ numeric.output_interval }}` seconds
- **Files**: wg01.dat, wg02.dat, etc.

#### Wave Statistics
- `QUANTITY HSIG`: Significant wave height calculation
- `QUANTITY SETUP`: Mean water level setup
- `dur=1800 sec`: **Hard-coded** 30-minute averaging period

#### Spatial Output
- `FRAME 'channel'`: Defines spatial output domain
- `{{ grid.nx_cells//4 }}`: **Calculated** spatial resolution (every 4th cell)
- **Variables**: WATLEV, VEL, HSIG, SETUP
- **File**: final_state.mat (MATLAB format)

### 10. Run Control
```swash
$=============================================================================
$ RUN
$=============================================================================
COMPUTE 000000.000 {{ numeric.time_step }} SEC {{ "%010.3f"|format(simulation_duration) }}

STOP
```

**Purpose**: Controls simulation execution
**Key commands**:
- `COMPUTE`: Starts simulation from t=0 with specified time step
- **End time**: `{{ simulation_duration }}` = `n_waves × wave_period`
- **Format**: Time formatted as HHMMSS.sss (e.g., 000300.000 for 5 minutes)

## Hard-coded vs. Configurable Parameters

### Hard-coded Parameters
These values are fixed in the template and not configurable:

| Parameter | Value | Location | Rationale |
|-----------|-------|----------|-----------|
| Gravity | 9.81 m/s² | Model setup | Physical constant |
| Manning's n | 0.019 | Physics | Typical for rock/concrete |
| Forchheimer coefficient | 200.0 | Porosity | Standard value for rock |
| Shape factor | 1.1 | Porosity | Standard value for rock |
| CFL range | 0.4-0.8 | Numerics | Stable explicit time stepping |
| Sponge length | 10.0 m | Wave generation | Adequate absorption |
| Box scheme θ | 1.0 | Numerics | Implicit, stable |
| Statistics duration | 1800 s | Output | Standard 30-minute averaging |

### Configurable Parameters
These values come from the configuration file:

| Parameter | Config path | Default | Units |
|-----------|-------------|---------|-------|
| Domain length | `grid.length` | 112.0 | m |
| Grid cells | `grid.nx_cells` | 500 | - |
| Water level | `water.water_level` | 1.0 | m |
| Wave height | `water.wave_height` | 0.6 | m |
| Wave period | `water.wave_period` | 6.0 | s |
| Structure position | `numeric.breakwater_start_position` | 100.0 | m |
| Output interval | `numeric.output_interval` | 0.1 | s |

## Template Processing

### Jinja2 Features Used

#### Variable Substitution
```jinja2
SET level={{ water.water_level }} grav=9.81 rhowat={{ water.water_density }}
```

#### Calculations
```jinja2
{%- set breakwater_end = numeric.breakwater_start_position + breakwater.crest_width + 2 * (breakwater.crest_height * breakwater.slope) %}
```

#### Conditional Sections
```jinja2
{%- if vegetation.enable %}
VEGETATION {{ vegetation.plant_height }} {{ vegetation.plant_diameter }} ...
{%- endif %}
```

#### Loops
```jinja2
{%- for i, pos in enumerate(numeric.wave_gauge_positions) %}
POINTS 'WG{{ "%02d"|format(i+1) }}' {{ pos }} 0.0
{%- endfor %}
```

#### Formatting
```jinja2
$ Breakwater: {{ numeric.breakwater_start_position }}m to {{ "%.1f"|format(breakwater_end) }}m
```

### Template Context
The template receives a context dictionary with all configuration groups:
```python
template_vars = {
    "name": config.name,
    "grid": config.grid,
    "breakwater": config.breakwater,
    "water": config.water,
    "vegetation": config.vegetation,
    "numeric": config.numeric,
    "simulation_duration": config.simulation_duration,
    "enumerate": enumerate,  # Python built-in for loops
}
```

## Generated Files

The INPUT file references several data files that are automatically generated:

### 1. bathymetry.dat
```
0.000
0.000
...
0.000
```
**Format**: One elevation value per line (flat bottom)

### 2. porosity.dat  
```
0.000  0.000  ... 0.400  0.400  ... 0.000
```
**Format**: One porosity value per grid cell

### 3. structure_height.dat
```
0.000  0.000  ... 2.000  2.000  ... 0.000  
```
**Format**: One height value per grid cell

### 4. vegetation_density.dat (if vegetation enabled)
```
0.0  0.0  ... 10.0  10.0  ... 0.0
```
**Format**: Spatially varying density - zero except on breakwater crest
**Crest zone**: Calculated as breakwater extent minus side slopes
**Values**: 0.0 (no vegetation) or `plant_density` (vegetated crest)

## Validation and Debugging

### Checking Generated INPUT
```bash
# Run simulation to generate INPUT file
swg run config/dev.yml

# Review generated INPUT file
cat simulations/dev_<hash>/INPUT

# Check data files
head simulations/dev_<hash>/bathymetry.dat
head simulations/dev_<hash>/porosity.dat
```

### Common Issues

#### 1. Template Syntax Errors
- **Missing variables**: Check configuration file completeness
- **Type errors**: Ensure correct data types in configuration

#### 2. SWASH Syntax Errors
- **Parameter order**: SWASH commands have specific parameter sequences
- **Formatting**: Some parameters require integer formatting

#### 3. Physical Inconsistencies
- **Unrealistic values**: Check wave steepness, relative depth
- **Geometric conflicts**: Verify breakwater fits within domain

## Next Steps

- **[Configuration Guide](configuration-guide.md)**: Learn how to set parameters that control INPUT generation
- **[Simulation Workflow](simulation-workflow.md)**: Understand how INPUT files are processed
- **[Physics and Parameters](physics-and-parameters.md)**: Learn the physical meaning behind SWASH commands
- **[Troubleshooting](troubleshooting.md)**: Solutions for INPUT file generation issues
